# ç”µç«èµ›äº‹æ¨¡æ‹Ÿç³»ç»Ÿ - æ•°æ®åº“æ“ä½œæŒ‡å—

## ğŸ“‹ ç›®å½•
1. [ç¯å¢ƒå‡†å¤‡](#1-ç¯å¢ƒå‡†å¤‡)
2. [æ•°æ®åº“åˆ›å»ºä¸åˆå§‹åŒ–](#2-æ•°æ®åº“åˆ›å»ºä¸åˆå§‹åŒ–)
3. [è¡¨ç»“æ„è¯¦è§£](#3-è¡¨ç»“æ„è¯¦è§£)
4. [æ•°æ®åº“æ“ä½œæ­¥éª¤](#4-æ•°æ®åº“æ“ä½œæ­¥éª¤)
5. [åˆå§‹æ•°æ®æ’å…¥](#5-åˆå§‹æ•°æ®æ’å…¥)
6. [å¸¸ç”¨æŸ¥è¯¢ç¤ºä¾‹](#6-å¸¸ç”¨æŸ¥è¯¢ç¤ºä¾‹)
7. [æ•°æ®åº“ç»´æŠ¤](#7-æ•°æ®åº“ç»´æŠ¤)
8. [æ•…éšœæ’é™¤](#8-æ•…éšœæ’é™¤)

---

## 1. ç¯å¢ƒå‡†å¤‡

### 1.1 ç¡®è®¤æ•°æ®åº“æœåŠ¡è¿è¡Œ

```bash
# æ£€æŸ¥ PostgreSQL æœåŠ¡çŠ¶æ€
docker-compose ps

# å¦‚æœæ•°æ®åº“æœªè¿è¡Œï¼Œå¯åŠ¨æœåŠ¡
docker-compose up postgres redis -d

# æŸ¥çœ‹æ•°æ®åº“æœåŠ¡æ—¥å¿—
docker-compose logs postgres
```

### 1.2 è¿æ¥æ•°æ®åº“

```bash
# æ–¹æ³•1: ä½¿ç”¨ Docker å®¹å™¨è¿æ¥
docker-compose exec postgres psql -U postgres -d esports_simulator

# æ–¹æ³•2: ä½¿ç”¨æœ¬åœ° psql å®¢æˆ·ç«¯
psql -h localhost -p 5432 -U postgres -d esports_simulator

# æ–¹æ³•3: ä½¿ç”¨æ•°æ®åº“ç®¡ç†å·¥å…· (æ¨è)
# è®¿é—® http://localhost:8080 (Adminer)
# æˆ–ä½¿ç”¨ pgAdmin, DBeaver ç­‰å·¥å…·
```

### 1.3 ç¯å¢ƒå˜é‡ç¡®è®¤

æ£€æŸ¥ `.env` æ–‡ä»¶ä¸­çš„æ•°æ®åº“é…ç½®ï¼š

```bash
# æŸ¥çœ‹å½“å‰é…ç½®
cat .env | grep DB_

# åº”è¯¥åŒ…å«ä»¥ä¸‹é…ç½®
DB_HOST=localhost
DB_PORT=5432
DB_USERNAME=postgres
DB_PASSWORD=postgres
DB_NAME=esports_simulator
DB_SSL=false
```

---

## 2. æ•°æ®åº“åˆ›å»ºä¸åˆå§‹åŒ–

### 2.1 åˆ›å»ºæ•°æ®åº“

```sql
-- è¿æ¥åˆ° PostgreSQL æœåŠ¡å™¨
psql -U postgres

-- åˆ›å»ºæ•°æ®åº“
CREATE DATABASE esports_simulator;

-- åˆ‡æ¢åˆ°æ–°æ•°æ®åº“
\c esports_simulator;
```

### 2.2 æ‰§è¡Œåˆå§‹åŒ–è„šæœ¬

```bash
# æ–¹æ³•1: ç›´æ¥æ‰§è¡Œ SQL æ–‡ä»¶
psql -h localhost -p 5432 -U postgres -d esports_simulator -f scripts/init-db.sql

# æ–¹æ³•2: é€šè¿‡ Docker å®¹å™¨æ‰§è¡Œ
docker-compose exec postgres psql -U postgres -d esports_simulator -f /docker-entrypoint-initdb.d/init-db.sql

# æ–¹æ³•3: å¤åˆ¶ç²˜è´´æ‰§è¡Œ
# å°† init-db.sql æ–‡ä»¶å†…å®¹å¤åˆ¶åˆ° psql å‘½ä»¤è¡Œä¸­æ‰§è¡Œ
```

### 2.3 éªŒè¯åˆå§‹åŒ–ç»“æœ

```sql
-- æ£€æŸ¥è¡¨æ˜¯å¦åˆ›å»ºæˆåŠŸ
\dt

-- æ£€æŸ¥è§†å›¾
\dv

-- æ£€æŸ¥å‡½æ•°
\df

-- æ£€æŸ¥ç´¢å¼•
\di

-- æŸ¥çœ‹è¡¨ç»“æ„
\d teams
\d matches
\d score_records
```

---

## 3. è¡¨ç»“æ„è¯¦è§£

### 3.1 æ ¸å¿ƒä¸šåŠ¡è¡¨

#### 3.1.1 èµ›åŒºè¡¨ (regions)
```sql
-- ä½œç”¨: å­˜å‚¨èµ›åŒºä¿¡æ¯ (LPL, LCK, LEC, LCSç­‰)
-- ä¸»è¦å­—æ®µ:
-- - id: ä¸»é”®
-- - name: èµ›åŒºåç§°
-- - code: èµ›åŒºä»£ç 
-- - display_order: æ˜¾ç¤ºé¡ºåº
```

#### 3.1.2 æˆ˜é˜Ÿè¡¨ (teams)
```sql
-- ä½œç”¨: å­˜å‚¨æˆ˜é˜ŸåŸºæœ¬ä¿¡æ¯å’Œç»Ÿè®¡æ•°æ®
-- ä¸»è¦å­—æ®µ:
-- - id: ä¸»é”®
-- - name: æˆ˜é˜Ÿåç§°
-- - region_id: æ‰€å±èµ›åŒº
-- - power_rating: æˆ˜åŠ›å€¼ (0-100)
-- - total_matches: æ€»æ¯”èµ›åœºæ¬¡
-- - total_wins/total_losses: èƒœ/è´Ÿåœºæ•°
-- - net_round_difference: å‡€èƒœå±€æ•°
```

#### 3.1.3 æ¯”èµ›è¡¨ (matches)
```sql
-- ä½œç”¨: å­˜å‚¨å…·ä½“æ¯”èµ›ä¿¡æ¯å’Œç»“æœ
-- ä¸»è¦å­—æ®µ:
-- - id: ä¸»é”®
-- - competition_id: æ‰€å±èµ›äº‹
-- - team_a_id, team_b_id: å¯¹é˜µåŒæ–¹
-- - score_a, score_b: æ¯”åˆ†
-- - winner_id: è·èƒœæ–¹
-- - format: èµ›åˆ¶ (BO1/BO3/BO5)
-- - phase: é˜¶æ®µ (å¸¸è§„èµ›/å­£åèµ›ç­‰)
```

### 3.2 èµ›äº‹ç®¡ç†è¡¨

#### 3.2.1 èµ›å­£è¡¨ (seasons)
```sql
-- ä½œç”¨: ç®¡ç†å¹´åº¦èµ›å­£ä¿¡æ¯
-- ä¸»è¦å­—æ®µ:
-- - id: ä¸»é”®
-- - name: èµ›å­£åç§° (å¦‚ S1, S2)
-- - year: å¹´ä»½
-- - status: çŠ¶æ€ (planning/active/completed)
-- - current_phase: å½“å‰è¿›è¡Œé˜¶æ®µ
```

#### 3.2.2 èµ›äº‹è¡¨ (competitions)
```sql
-- ä½œç”¨: å­˜å‚¨å…·ä½“èµ›äº‹ä¿¡æ¯ (æ˜¥å­£èµ›/MSI/ä¸–ç•Œèµ›ç­‰)
-- ä¸»è¦å­—æ®µ:
-- - id: ä¸»é”®
-- - season_id: æ‰€å±èµ›å­£
-- - type: èµ›äº‹ç±»å‹ (spring/summer/msi/worlds)
-- - format: èµ›åˆ¶é…ç½® (JSON)
-- - scoring_rules: ç§¯åˆ†è§„åˆ™ (JSON)
```

### 3.3 ç»Ÿè®¡åˆ†æè¡¨

#### 3.3.1 ç§¯åˆ†è®°å½•è¡¨ (score_records)
```sql
-- ä½œç”¨: è®°å½•æˆ˜é˜Ÿè·å¾—çš„æ¯ä¸€åˆ†ç§¯åˆ†
-- ä¸»è¦å­—æ®µ:
-- - team_id: æˆ˜é˜ŸID
-- - competition_id: èµ›äº‹ID
-- - points: è·å¾—ç§¯åˆ†
-- - point_type: ç§¯åˆ†ç±»å‹
-- - season_year: èµ›å­£å¹´ä»½
```

#### 3.3.2 æˆ˜é˜Ÿç»Ÿè®¡è¡¨ (team_statistics)
```sql
-- ä½œç”¨: å­˜å‚¨æˆ˜é˜Ÿçš„èšåˆç»Ÿè®¡æ•°æ®
-- ä¸»è¦å­—æ®µ:
-- - team_id: æˆ˜é˜ŸID
-- - season_year: èµ›å­£å¹´ä»½
-- - total_points: æ€»ç§¯åˆ†
-- - spring_points, msi_points ç­‰: å„èµ›äº‹ç§¯åˆ†
-- - current_ranking: å½“å‰æ’å
```

---

## 4. æ•°æ®åº“æ“ä½œæ­¥éª¤

### 4.1 ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºå’Œè¿æ¥æ•°æ®åº“

```bash
# 1. å¯åŠ¨æ•°æ®åº“æœåŠ¡
cd /Users/showiix/Documents/EsportManager/backend
docker-compose up postgres redis -d

# 2. ç­‰å¾…æœåŠ¡å¯åŠ¨å®Œæˆ (çº¦10-30ç§’)
docker-compose logs postgres | grep "ready to accept connections"

# 3. è¿æ¥æ•°æ®åº“
docker-compose exec postgres psql -U postgres

# 4. åˆ›å»ºæ•°æ®åº“ (å¦‚æœä¸å­˜åœ¨)
CREATE DATABASE esports_simulator;

# 5. è¿æ¥åˆ°ç›®æ ‡æ•°æ®åº“
\c esports_simulator;
```

### 4.2 ç¬¬äºŒæ­¥ï¼šæ‰§è¡Œåˆå§‹åŒ–è„šæœ¬

```bash
# å°†åˆå§‹åŒ–è„šæœ¬å¤åˆ¶åˆ°å®¹å™¨ä¸­
docker cp scripts/init-db.sql esportmanager-backend-postgres-1:/tmp/

# åœ¨å®¹å™¨å†…æ‰§è¡Œè„šæœ¬
docker-compose exec postgres psql -U postgres -d esports_simulator -f /tmp/init-db.sql
```

æˆ–è€…ç›´æ¥åœ¨ psql ä¸­æ‰§è¡Œï¼š

```sql
-- å¤åˆ¶æ•´ä¸ª init-db.sql æ–‡ä»¶å†…å®¹ï¼Œç²˜è´´åˆ° psql å‘½ä»¤è¡Œä¸­æ‰§è¡Œ
-- è„šæœ¬ä¼šè‡ªåŠ¨åˆ›å»ºæ‰€æœ‰è¡¨ã€ç´¢å¼•ã€è§†å›¾å’Œå‡½æ•°
```

### 4.3 ç¬¬ä¸‰æ­¥ï¼šéªŒè¯æ•°æ®åº“ç»“æ„

```sql
-- åˆ—å‡ºæ‰€æœ‰è¡¨
SELECT table_name FROM information_schema.tables
WHERE table_schema = 'public' AND table_type = 'BASE TABLE';

-- æ£€æŸ¥å…³é”®è¡¨çš„ç»“æ„
\d teams
\d matches
\d competitions
\d score_records

-- æŸ¥çœ‹åˆ›å»ºçš„è§†å›¾
\dv

-- éªŒè¯ç´¢å¼•
SELECT indexname, tablename FROM pg_indexes WHERE schemaname = 'public';
```

### 4.4 ç¬¬å››æ­¥ï¼šåˆ›å»ºå¿…è¦çš„è„šæœ¬æ–‡ä»¶

å°† SQL è„šæœ¬ä¿å­˜åˆ° `backend/scripts/init-db.sql` æ–‡ä»¶ä¸­ï¼š

```bash
# åˆ›å»ºè„šæœ¬ç›®å½•
mkdir -p backend/scripts

# å°†åˆå§‹åŒ–è„šæœ¬ä¿å­˜ä¸ºæ–‡ä»¶
# (è„šæœ¬å†…å®¹è§ä¸Šé¢æä¾›çš„å®Œæ•´ SQL è„šæœ¬)
```

---

## 5. åˆå§‹æ•°æ®æ’å…¥

### 5.1 æ’å…¥åŸºç¡€èµ›åŒºæ•°æ®

```sql
-- æ’å…¥å››ä¸ªèµ›åŒº
INSERT INTO regions (name, code, display_order, description) VALUES
('ä¸­å›½å¤§é™†èŒä¸šè”èµ›', 'LPL', 1, 'ä¸­å›½å¤§é™†åœ°åŒºé¡¶çº§ç”µç«èŒä¸šè”èµ›'),
('éŸ©å›½å† å†›è”èµ›', 'LCK', 2, 'éŸ©å›½åœ°åŒºé¡¶çº§ç”µç«èŒä¸šè”èµ›'),
('æ¬§æ´²å† å†›è”èµ›', 'LEC', 3, 'æ¬§æ´²åœ°åŒºé¡¶çº§ç”µç«èŒä¸šè”èµ›'),
('åŒ—ç¾å† å†›è”èµ›', 'LCS', 4, 'åŒ—ç¾åœ°åŒºé¡¶çº§ç”µç«èŒä¸šè”èµ›');
```

### 5.2 æ’å…¥ç¤ºä¾‹æˆ˜é˜Ÿæ•°æ®

```sql
-- è·å–èµ›åŒºID
WITH region_ids AS (
    SELECT id as lpl_id FROM regions WHERE code = 'LPL'
    UNION ALL
    SELECT id as lck_id FROM regions WHERE code = 'LCK'
    UNION ALL
    SELECT id as lec_id FROM regions WHERE code = 'LEC'
    UNION ALL
    SELECT id as lcs_id FROM regions WHERE code = 'LCS'
)

-- æ’å…¥LPLæˆ˜é˜Ÿ (æ¯ä¸ªèµ›åŒº10æ”¯é˜Ÿä¼)
INSERT INTO teams (name, short_name, region_id, power_rating, founded_date)
SELECT * FROM (VALUES
    ('JD Gaming', 'JDG', (SELECT id FROM regions WHERE code = 'LPL'), 88, '2017-05-20'),
    ('Bilibili Gaming', 'BLG', (SELECT id FROM regions WHERE code = 'LPL'), 85, '2017-12-21'),
    ('Top Esports', 'TES', (SELECT id FROM regions WHERE code = 'LPL'), 82, '2019-11-26'),
    ('Weibo Gaming', 'WBG', (SELECT id FROM regions WHERE code = 'LPL'), 79, '2020-11-26'),
    ('Invictus Gaming', 'IG', (SELECT id FROM regions WHERE code = 'LPL'), 76, '2011-08-02'),
    ('FunPlus Phoenix', 'FPX', (SELECT id FROM regions WHERE code = 'LPL'), 74, '2017-12-21'),
    ('EDward Gaming', 'EDG', (SELECT id FROM regions WHERE code = 'LPL'), 72, '2013-09-13'),
    ('Royal Never Give Up', 'RNG', (SELECT id FROM regions WHERE code = 'LPL'), 70, '2012-05-15'),
    ('LNG Esports', 'LNG', (SELECT id FROM regions WHERE code = 'LPL'), 68, '2019-01-01'),
    ('Ninjas in Pyjamas', 'NIP', (SELECT id FROM regions WHERE code = 'LPL'), 65, '2021-11-26')
) AS t(name, short_name, region_id, power_rating, founded_date);

-- æ’å…¥LCKæˆ˜é˜Ÿ
INSERT INTO teams (name, short_name, region_id, power_rating, founded_date)
SELECT * FROM (VALUES
    ('T1', 'T1', (SELECT id FROM regions WHERE code = 'LCK'), 90, '2013-02-21'),
    ('Gen.G', 'GEN', (SELECT id FROM regions WHERE code = 'LCK'), 87, '2017-01-11'),
    ('DRX', 'DRX', (SELECT id FROM regions WHERE code = 'LCK'), 84, '2019-11-18'),
    ('KT Rolster', 'KT', (SELECT id FROM regions WHERE code = 'LCK'), 81, '2012-06-08'),
    ('Hanwha Life Esports', 'HLE', (SELECT id FROM regions WHERE code = 'LCK'), 78, '2016-12-01'),
    ('DWG KIA', 'DK', (SELECT id FROM regions WHERE code = 'LCK'), 75, '2017-02-14'),
    ('Liiv SANDBOX', 'LSB', (SELECT id FROM regions WHERE code = 'LCK'), 72, '2018-11-13'),
    ('Kwangdong Freecs', 'KDF', (SELECT id FROM regions WHERE code = 'LCK'), 69, '2016-11-30'),
    ('Nongshim RedForce', 'NS', (SELECT id FROM regions WHERE code = 'LCK'), 66, '2020-11-17'),
    ('OK Savings Bank BRION', 'BRO', (SELECT id FROM regions WHERE code = 'LCK'), 63, '2021-11-19')
) AS t(name, short_name, region_id, power_rating, founded_date);

-- ç»§ç»­æ’å…¥LECå’ŒLCSæˆ˜é˜Ÿ...
-- (ä¸ºç®€åŒ–ç¤ºä¾‹ï¼Œè¿™é‡Œä¸å®Œæ•´åˆ—å‡ºæ‰€æœ‰40æ”¯é˜Ÿä¼)
```

### 5.3 åˆ›å»ºç¤ºä¾‹èµ›å­£

```sql
-- åˆ›å»ºS1èµ›å­£
INSERT INTO seasons (name, year, status, current_phase, start_date, end_date)
VALUES ('S1', 2024, 'active', 'spring_regular', '2024-01-15', '2024-11-15');

-- è·å–èµ›å­£IDç”¨äºåç»­æ“ä½œ
SELECT id, name FROM seasons WHERE name = 'S1';
```

### 5.4 åˆ›å»ºç¤ºä¾‹æ˜¥å­£èµ›

```sql
-- åˆ›å»ºæ˜¥å­£èµ›äº‹
INSERT INTO competitions (season_id, type, name, format, scoring_rules, max_teams, start_date, end_date)
VALUES (
    (SELECT id FROM seasons WHERE name = 'S1'),
    'spring',
    'S1æ˜¥å­£èµ›',
    '{"type": "league", "regular_season": {"format": "double_round_robin", "match_format": "BO3"}, "playoffs": {"format": "double_elimination", "match_format": "BO5"}}',
    '{"regular": {"win_2_0": 3, "win_2_1": 2, "loss_1_2": 1, "loss_0_2": 0}, "playoffs": {"champion": 12, "runner_up": 10, "third_place": 8, "fourth_place": 6}}',
    40,
    '2024-01-15',
    '2024-04-15'
);
```

---

## 6. å¸¸ç”¨æŸ¥è¯¢ç¤ºä¾‹

### 6.1 åŸºç¡€æŸ¥è¯¢

```sql
-- æŸ¥çœ‹æ‰€æœ‰æˆ˜é˜ŸåŠå…¶èµ›åŒº
SELECT t.name, t.short_name, t.power_rating, r.name as region_name
FROM teams t
JOIN regions r ON t.region_id = r.id
ORDER BY r.display_order, t.power_rating DESC;

-- æŸ¥çœ‹æŸä¸ªèµ›åŒºçš„æˆ˜é˜Ÿ
SELECT name, short_name, power_rating, total_wins, total_losses
FROM teams t
JOIN regions r ON t.region_id = r.id
WHERE r.code = 'LPL'
ORDER BY power_rating DESC;

-- æŸ¥çœ‹è¿›è¡Œä¸­çš„èµ›äº‹
SELECT s.name as season_name, c.name, c.type, c.status
FROM competitions c
JOIN seasons s ON c.season_id = s.id
WHERE c.status = 'active';
```

### 6.2 æ¯”èµ›å’Œç§¯åˆ†æŸ¥è¯¢

```sql
-- æŸ¥çœ‹æœ€è¿‘çš„æ¯”èµ›ç»“æœ
SELECT * FROM v_match_results
WHERE status = 'completed'
ORDER BY completed_at DESC
LIMIT 10;

-- æŸ¥çœ‹æˆ˜é˜Ÿçš„å†å²äº¤é”‹è®°å½•
SELECT
    ta.name as team_a,
    tb.name as team_b,
    hth.total_matches,
    hth.team_a_wins,
    hth.team_b_wins,
    hth.last_match_date
FROM head_to_head_records hth
JOIN teams ta ON hth.team_a_id = ta.id
JOIN teams tb ON hth.team_b_id = tb.id
WHERE ta.name = 'JD Gaming' OR tb.name = 'JD Gaming';

-- æŸ¥çœ‹ç§¯åˆ†æ’è¡Œæ¦œ
SELECT * FROM v_team_rankings
WHERE season_year = 2024
ORDER BY total_points DESC
LIMIT 20;
```

### 6.3 ç»Ÿè®¡åˆ†ææŸ¥è¯¢

```sql
-- å„èµ›åŒºèƒœç‡ç»Ÿè®¡
SELECT
    r.name as region_name,
    COUNT(t.id) as team_count,
    AVG(t.power_rating) as avg_power_rating,
    SUM(t.total_wins) as total_wins,
    SUM(t.total_matches) as total_matches,
    ROUND(SUM(t.total_wins)::DECIMAL / NULLIF(SUM(t.total_matches), 0) * 100, 2) as win_rate
FROM regions r
LEFT JOIN teams t ON r.id = t.region_id
WHERE t.is_active = true
GROUP BY r.id, r.name
ORDER BY win_rate DESC;

-- æŸ¥çœ‹æˆ˜é˜Ÿç§¯åˆ†åˆ†å¸ƒ
SELECT
    team_name,
    region_name,
    total_points,
    spring_points,
    msi_points,
    summer_points,
    worlds_points
FROM v_team_rankings
WHERE season_year = 2024 AND total_points > 0
ORDER BY total_points DESC;
```

---

## 7. æ•°æ®åº“ç»´æŠ¤

### 7.1 å®šæœŸç»´æŠ¤ä»»åŠ¡

```sql
-- æ›´æ–°è¡¨ç»Ÿè®¡ä¿¡æ¯
ANALYZE;

-- é‡å»ºç´¢å¼• (å¦‚æœéœ€è¦)
REINDEX DATABASE esports_simulator;

-- æ¸…ç†æ— ç”¨æ•°æ®
VACUUM;

-- æŸ¥çœ‹æ•°æ®åº“å¤§å°
SELECT pg_size_pretty(pg_database_size('esports_simulator'));

-- æŸ¥çœ‹è¡¨å¤§å°
SELECT
    schemaname,
    tablename,
    pg_size_pretty(pg_total_relation_size(schemaname||'.'||tablename)) as size
FROM pg_tables
WHERE schemaname = 'public'
ORDER BY pg_total_relation_size(schemaname||'.'||tablename) DESC;
```

### 7.2 æ€§èƒ½ç›‘æ§

```sql
-- æŸ¥çœ‹æ…¢æŸ¥è¯¢
SELECT query, mean_time, calls
FROM pg_stat_statements
ORDER BY mean_time DESC
LIMIT 10;

-- æŸ¥çœ‹è¡¨è®¿é—®ç»Ÿè®¡
SELECT
    schemaname,
    tablename,
    seq_scan,
    seq_tup_read,
    idx_scan,
    idx_tup_fetch
FROM pg_stat_user_tables
WHERE schemaname = 'public';

-- æŸ¥çœ‹ç´¢å¼•ä½¿ç”¨æƒ…å†µ
SELECT
    schemaname,
    tablename,
    indexname,
    idx_scan,
    idx_tup_read,
    idx_tup_fetch
FROM pg_stat_user_indexes
WHERE schemaname = 'public'
ORDER BY idx_scan DESC;
```

### 7.3 æ•°æ®å¤‡ä»½

```bash
# åˆ›å»ºå®Œæ•´å¤‡ä»½
pg_dump -h localhost -p 5432 -U postgres -d esports_simulator -f backup_$(date +%Y%m%d_%H%M%S).sql

# åˆ›å»ºå‹ç¼©å¤‡ä»½
pg_dump -h localhost -p 5432 -U postgres -d esports_simulator | gzip > backup_$(date +%Y%m%d_%H%M%S).sql.gz

# åªå¤‡ä»½æ•°æ® (ä¸åŒ…å«ç»“æ„)
pg_dump -h localhost -p 5432 -U postgres -d esports_simulator --data-only -f data_backup_$(date +%Y%m%d_%H%M%S).sql

# æ¢å¤å¤‡ä»½
psql -h localhost -p 5432 -U postgres -d esports_simulator -f backup_20241010_120000.sql
```

---

## 8. æ•…éšœæ’é™¤

### 8.1 å¸¸è§é—®é¢˜

#### é—®é¢˜1: æ— æ³•è¿æ¥æ•°æ®åº“
```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
docker-compose ps postgres

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
docker-compose logs postgres

# é‡å¯æ•°æ®åº“æœåŠ¡
docker-compose restart postgres
```

#### é—®é¢˜2: æƒé™é”™è¯¯
```sql
-- èµ‹äºˆç”¨æˆ·æƒé™
GRANT ALL PRIVILEGES ON DATABASE esports_simulator TO postgres;
GRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA public TO postgres;
GRANT ALL PRIVILEGES ON ALL SEQUENCES IN SCHEMA public TO postgres;
```

#### é—®é¢˜3: è¡¨ä¸å­˜åœ¨
```sql
-- æ£€æŸ¥è¡¨æ˜¯å¦å­˜åœ¨
SELECT table_name FROM information_schema.tables
WHERE table_schema = 'public' AND table_name = 'teams';

-- é‡æ–°åˆ›å»ºè¡¨ (é‡æ–°æ‰§è¡Œåˆå§‹åŒ–è„šæœ¬)
\i /path/to/init-db.sql
```

### 8.2 æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥

```sql
-- æ£€æŸ¥å­¤ç«‹æ•°æ®
-- æ£€æŸ¥æ²¡æœ‰èµ›åŒºçš„æˆ˜é˜Ÿ
SELECT * FROM teams WHERE region_id NOT IN (SELECT id FROM regions);

-- æ£€æŸ¥æ²¡æœ‰æˆ˜é˜Ÿçš„æ¯”èµ›
SELECT * FROM matches
WHERE team_a_id NOT IN (SELECT id FROM teams)
   OR team_b_id NOT IN (SELECT id FROM teams);

-- æ£€æŸ¥ç§¯åˆ†è®°å½•ä¸æˆ˜é˜Ÿçš„ä¸€è‡´æ€§
SELECT * FROM score_records
WHERE team_id NOT IN (SELECT id FROM teams);

-- ä¿®å¤ç»Ÿè®¡æ•°æ®ä¸ä¸€è‡´
UPDATE teams SET
    total_matches = (
        SELECT COUNT(*) FROM matches
        WHERE (team_a_id = teams.id OR team_b_id = teams.id)
        AND status = 'completed'
    ),
    total_wins = (
        SELECT COUNT(*) FROM matches
        WHERE winner_id = teams.id
    ),
    total_losses = (
        SELECT COUNT(*) FROM matches
        WHERE (team_a_id = teams.id OR team_b_id = teams.id)
        AND status = 'completed'
        AND winner_id != teams.id
    );
```

### 8.3 æ€§èƒ½ä¼˜åŒ–

```sql
-- åˆ†ææ…¢æŸ¥è¯¢
EXPLAIN ANALYZE SELECT * FROM v_team_rankings WHERE season_year = 2024;

-- åˆ›å»ºç¼ºå¤±çš„ç´¢å¼•
CREATE INDEX IF NOT EXISTS idx_score_records_season_points
ON score_records(season_year, points DESC);

-- æ›´æ–°è¡¨ç»Ÿè®¡ä¿¡æ¯
ANALYZE teams;
ANALYZE matches;
ANALYZE score_records;
```

---

## 9. ä¸‹ä¸€æ­¥æ“ä½œå»ºè®®

### 9.1 å®Œæˆæ•°æ®åº“è®¾ç½®å

1. **éªŒè¯è¿æ¥**: ç¡®ä¿åº”ç”¨èƒ½æ­£å¸¸è¿æ¥æ•°æ®åº“
```bash
cd backend
npm run dev
# æ£€æŸ¥æ§åˆ¶å°æ˜¯å¦æ˜¾ç¤ºæ•°æ®åº“è¿æ¥æˆåŠŸ
```

2. **æµ‹è¯•API**: ä½¿ç”¨å¥åº·æ£€æŸ¥ç«¯ç‚¹éªŒè¯
```bash
curl http://localhost:3000/health
```

3. **æ·»åŠ ç§å­æ•°æ®**: æ ¹æ®éœ€è¦æ·»åŠ æ›´å¤šæµ‹è¯•æ•°æ®

### 9.2 å¼€å‘é˜¶æ®µå»ºè®®

1. **ä½¿ç”¨æ•°æ®åº“ç®¡ç†å·¥å…·**:
   - Adminer: http://localhost:8080
   - ç”¨æˆ·å: postgres, å¯†ç : postgres, æ•°æ®åº“: esports_simulator

2. **APIæµ‹è¯•**: ä½¿ç”¨ Postman æˆ–ç±»ä¼¼å·¥å…·æµ‹è¯•APIæ¥å£

3. **æ•°æ®ç›‘æ§**: å®šæœŸæ£€æŸ¥æ•°æ®ä¸€è‡´æ€§å’Œæ€§èƒ½

### 9.3 ç”Ÿäº§ç¯å¢ƒå‡†å¤‡

1. **å®‰å…¨é…ç½®**: ä¿®æ”¹é»˜è®¤å¯†ç å’Œæƒé™è®¾ç½®
2. **å¤‡ä»½ç­–ç•¥**: å»ºç«‹å®šæœŸå¤‡ä»½æœºåˆ¶
3. **ç›‘æ§å‘Šè­¦**: é…ç½®æ•°æ®åº“æ€§èƒ½ç›‘æ§
4. **è¿æ¥æ± **: ä¼˜åŒ–æ•°æ®åº“è¿æ¥æ± é…ç½®

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœåœ¨æ•°æ®åº“è®¾ç½®è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œå¯ä»¥ï¼š

1. **æ£€æŸ¥æ—¥å¿—**: `docker-compose logs postgres`
2. **æŸ¥çœ‹æ–‡æ¡£**: PostgreSQLå®˜æ–¹æ–‡æ¡£
3. **é‡æ–°åˆå§‹åŒ–**: åˆ é™¤æ•°æ®å·åé‡æ–°åˆ›å»º

```bash
# é‡æ–°åˆå§‹åŒ–æ•°æ®åº“ (æ…ç”¨!)
docker-compose down -v
docker-compose up postgres redis -d
# ç„¶åé‡æ–°æ‰§è¡Œåˆå§‹åŒ–æ­¥éª¤
```

**æ•°æ®åº“åˆå§‹åŒ–å®Œæˆåï¼Œä½ å°±å¯ä»¥å¼€å§‹å¼€å‘å’Œæµ‹è¯•ç”µç«èµ›äº‹æ¨¡æ‹Ÿç³»ç»Ÿçš„åç«¯åŠŸèƒ½äº†ï¼**